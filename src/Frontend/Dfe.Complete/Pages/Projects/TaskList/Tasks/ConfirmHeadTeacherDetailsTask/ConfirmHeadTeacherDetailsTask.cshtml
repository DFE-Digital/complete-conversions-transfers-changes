@page "/projects/{projectId}/tasks/confirm_headteacher_contact"
@using Dfe.Complete.Constants
@using Dfe.Complete.Domain.Constants
@using Dfe.Complete.TagHelpers;
@using Microsoft.AspNetCore.Authorization
@inject Microsoft.Extensions.Configuration.IConfiguration _configuration
@inject IAuthorizationService Authorization
@model Dfe.Complete.Pages.Projects.TaskList.Tasks.ConfirmHeadTeacherDetailsTask.ConfirmHeadTeachersDetailsTaskModel

@{
    Layout = "_ProjectTaskLayout";
    ViewData["Title"] = "Confirm the headteacher’s details";
    var projectsExternalContactLink = string.Format(RouteConstants.ProjectExternalContacts, Model.ProjectId);
    var projectsExternalContactAddNewLink = string.Format(RouteConstants.NewProjectExternalContacts, Model.ProjectId);
    var canAddContact = await Authorization.AuthorizeAsync(User, policyName: UserPolicyConstants.CanEditAddedByUser);
}
@section TaskHeaderHintSection
{
    <div class="govuk-hint">
        @if (canAddContact.Succeeded)
        {
            <p>Check the contact details are correct, <a href="@projectsExternalContactLink" data-cy="external-contacts-link">edit incorrect contact details and add missing contacts</a>. You may need to contact the person who previously worked on the project to verify this.</p>
        }
        else
        {
            <p>Check the contact details are correct. You may need to contact the person who previously worked on the project to verify this.</p>
        }        
    </div>
}
@section TaskSection {
    <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">Who is the headteacher?</legend>
    @if (Model?.Contacts != null && Model.Contacts.Count > 0)
    {
        <form method="post" novalidate data-cy="task-update-head-teacher-form">
            <div class="govuk-hint">
                <p>Choose the relevant person from the list of contacts. You may need to add a new contact if the person you are looking for is not in the list.</p>
                <p>Their job title may be slightly different to the role described here. Choose the person whose role most closely matches the headteacher.</p>
            </div>

            <input type="hidden" asp-for="KeyContactId" />            
            @await Html.PartialAsync("_TaskContactRadioList",
            new ContactRadioListModel(Model.Contacts!, Model.HeadTeacherContactId, "HeadTeacherContactId")
            {
                Legend = "Choose a contact"
            }
        )
            @await Html.PartialAsync("_TaskSaveAndReturn", new TaskSaveAndReturnModel(Model.Project, Model.CurrentUserTeam))
        </form>
        }
    else
    {
        <govuk-inset-text>
            No contacts have been added to the project.
        </govuk-inset-text>
        <govuk-button-link asp-policy="@UserPolicyConstants.CanAddContact" href="@projectsExternalContactAddNewLink" data-cy="external-contacts-add-new-button">Add a contact</govuk-button-link>
    }
}