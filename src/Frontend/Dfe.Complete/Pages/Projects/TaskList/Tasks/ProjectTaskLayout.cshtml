@using Dfe.Complete.Constants
@model Dfe.Complete.Pages.Projects.ProjectTaskModel
@{
    Layout = "Shared/_Layout";
    ViewData["Title"] = $"{Model.Title} - Complete conversions, transfers and changes";

    var backLink = string.Format(RouteConstants.ProjectTaskList, Model.ProjectId);
}

@section BeforeMain
{
    <govuk-back-link href="@backLink" xmlns="http://www.w3.org/1999/html" />
}

<div class="govuk-grid-row govuk-!-margin-bottom-9">
    <div class="govuk-grid-column-two-thirds">
        <span class="govuk-caption-l">@Model.SchoolName</span>
        <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">@Model.Title</h1>
        @RenderSection("TaskContent", required: true)
    </div>
    <div class="govuk-grid-column-one-third">
        <aside>
            <h2 class="govuk-heading-m govuk-!-margin-bottom-2">Task notes</h2>
            <form method="post" asp-page-handler="AddNote">
                <button data-module="govuk-button" class="govuk-button govuk-button--secondary govuk-!-margin-bottom-2" type="submit">
                    Add a new task note
                </button>
            </form>
            <ul class="list-style-none govuk-!-margin-bottom-0">
            @if (Model.Notes != null && Model.Notes.Any())
            {
                foreach (var note in Model.Notes)
                {
                    <li class="govuk-!-margin-bottom-2">
                        <p class="govuk-body govuk-!-margin-bottom-0">@note.CreatedAt.ToString("dd MMM yyyy")</p>
                        <h3 class="govuk-heading-s govuk-!-padding-top-0 govuk-!-margin-bottom-1">@note.UserFullName</h3>
                        <p class="govuk-body govuk-!-margin-bottom-1">@note.Body</p>
                        <div class="app-task-note-actions govuk-!-margin-bottom-1">
                            <a class="govuk-link govuk-link--no-visited-state app-task-note-edit-link" href="@string.Format(RouteConstants.ProjectEditNote, Model.ProjectId, note.Id.Value, Model.TaskIdentifier)">Edit note</a>
                        </div>
                        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible govuk-!-margin-bottom-2" />
                    </li>
                }
            }
            </ul>
        </aside>
    </div>
</div>
