@page "/projects/{projectId}/notes"
@using Dfe.Complete.Constants
@using Dfe.Complete.Extensions;
@using Dfe.Complete.Domain.Enums;
@using Dfe.Complete.Domain.Constants;
@model Dfe.Complete.Pages.Projects.Notes.ViewProjectNotesModel
@{
    Layout = "_ProjectLayout";
    ViewData["Title"] = "Project notes";

    var addNoteLink = string.Format(RouteConstants.ProjectAddNote, Model.ProjectId);
    var userId = User.GetUserId();

    var projectEditable = Model.Project.State != ProjectState.Completed;
}

<govuk-project-tabs project-id="@Model.ProjectId" project-type="" />

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-l">Notes</h2>

        <div class="govuk-!-margin-bottom-5">
            <form method="post" asp-page-handler="AddNote">
                <button data-module="govuk-button" class="govuk-button" type="submit">
                    Add note
                </button>
            </form>
        </div>

        @if (Model.Notes.Count == 0)
        {
            <div class="govuk-inset-text">There are not any notes for this project yet.</div>
        }

        @foreach (var note in Model.Notes)
        {
            var editNoteLink = string.Format(RouteConstants.ProjectEditNote, Model.ProjectId, note.Id);

            <div id="note-entry-@note.Id">
                <span class="govuk-caption-m">@note.CreatedAt.ToDateString()</span>
                <h3 class="govuk-heading-m">@note.UserFullName</h3>
                <p class="govuk-body-m">@note.Body</p>
                @if (projectEditable && userId == note.UserId)
                {
                    <p class="govuk-body govuk-!-font-size-16">
                        <a class="govuk-link" href="@editNoteLink">Edit</a>
                    </p>
                }
            </div>
        }

    </div>
</div>
